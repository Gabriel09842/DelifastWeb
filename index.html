<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delifast - Tu Delivery RÃ¡pido (PC Responsive)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Custom Purple Theme for Delifast */
        :root {
            --primary-purple: #6F2DBD; /* Darker Purple */
            --light-purple: #8A4DC4;  /* Lighter Purple */
            --bg-light-purple: #F3ECFA; /* Very light background purple */
            --text-dark: #2D0F4B; /* Dark text for contrast */
            --accent-green: #34D399; /* A fresh accent for positive actions */
            --gray-text: #6B7280;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light-purple);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* Prevent horizontal scroll */
            display: flex;
            justify-content: flex-start; /* Align to start for full width */
            align-items: flex-start;
            min-height: 100vh;
            width: 100%; /* Ensure body takes full width */
        }

        /* Main app container for desktop layout - now truly edge-to-edge */
        .app-container {
            width: 100%; /* Take full width on larger screens */
            max-width: none; /* Remove max-width constraint for full responsiveness */
            background-color: #fff;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); /* Keep shadow for depth */
            border-radius: 0; /* No border-radius for edge-to-edge design */
            overflow: hidden;
            display: grid; /* Use grid for desktop layout */
            grid-template-columns: 250px 1fr; /* Sidebar fixed width, main content takes rest */
            min-height: 100vh; /* Full height of viewport */
            position: relative;
        }

        /* Responsive adjustments for app-container: Optional border-radius for slightly smaller desktop views */
        @media (min-width: 768px) and (max-width: 1400px) { /* Example range for a slightly "boxed" look */
            .app-container {
                border-radius: 20px; /* Re-apply border-radius for tablet/mid-desktop sizes */
                max-width: 1200px; /* Max-width for mid-sized screens to keep content centered */
                margin: 0 auto; /* Center the container when max-width is active */
            }
        }


        /* Sidebar styling */
        .sidebar {
            background-color: #fff;
            padding: 1.5rem;
            border-right: 1px solid var(--bg-light-purple);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            overflow-y: auto;
            position: relative;
        }

        .main-content {
            flex-grow: 1; /* Allow main content to take available space */
            overflow-y: auto; /* Enable scrolling for main content */
            display: flex;
            flex-direction: column;
            height: 100%; /* Ensure it fills the app-container height */
        }

        /* Hide screens by default, show active one */
        .screen {
            display: none;
            flex-grow: 1;
            overflow-y: auto;
            padding-bottom: 2rem;
            -webkit-overflow-scrolling: touch;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }

        /* Sticky header */
        .header {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: #fff;
            padding-bottom: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* Custom scrollbar for webkit browsers */
        .main-content::-webkit-scrollbar,
        .screen::-webkit-scrollbar,
        .sidebar::-webkit-scrollbar,
        .horizontal-scroll-container::-webkit-scrollbar { /* Add for horizontal containers */
            height: 8px; /* Height for horizontal scrollbar */
            width: 8px; /* Width for vertical scrollbar */
        }

        .main-content::-webkit-scrollbar-track,
        .screen::-webkit-scrollbar-track,
        .sidebar::-webkit-scrollbar-track,
        .horizontal-scroll-container::-webkit-scrollbar-track {
            background: var(--bg-light-purple);
            border-radius: 10px;
        }

        .main-content::-webkit-scrollbar-thumb,
        .screen::-webkit-scrollbar-thumb,
        .sidebar::-webkit-scrollbar-thumb,
        .horizontal-scroll-container::-webkit-scrollbar-thumb {
            background: var(--light-purple);
            border-radius: 10px;
        }

        .main-content::-webkit-scrollbar-thumb:hover,
        .screen::-webkit-scrollbar-thumb:hover,
        .sidebar::-webkit-scrollbar-thumb:hover,
        .horizontal-scroll-container::-webkit-scrollbar-thumb:hover {
            background: var(--primary-purple);
        }

        /* Styling for the quantity controls - Smaller buttons */
        .quantity-control button {
            @apply bg-gray-200 text-gray-700 px-2 py-1 rounded-full font-bold text-base; /* Smaller padding and font */
            transition: background-color 0.2s;
        }
        .quantity-control button:hover {
            @apply bg-gray-300;
        }

        /* Smooth transitions for button hovers/taps */
        button, a, .cursor-pointer {
            transition: transform 0.1s ease-in-out, background-color 0.2s ease-in-out;
        }
        button:active, a:active, .cursor-pointer:active {
            transform: scale(0.98);
        }

        /* Modal styling */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        /* Style for the Delifast logo to match the purple theme */
        #delifastLogo {
            filter: invert(19%) sepia(91%) saturate(1917%) hue-rotate(253deg) brightness(85%) contrast(87%);
        }

        /* Adjustments for general text sizes on desktop */
        .header h1 {
            font-size: 2.5rem; /* Larger title for desktop */
        }
        .header h2 {
            font-size: 2rem;
        }
        .text-3xl {
            font-size: 2.25rem;
        }
        .text-2xl {
            font-size: 1.5rem;
        }
        .text-xl {
            font-size: 1.25rem;
        }
        .text-lg {
            font-size: 1.125rem;
        }
        .text-md {
            font-size: 1rem;
        }
        .text-sm {
            font-size: 0.875rem;
        }
        .text-xs {
            font-size: 0.75rem;
        }

        /* Primary action buttons - Smaller on desktop */
        .primary-button {
            @apply text-lg py-3; /* Reduced padding for primary buttons */
        }

        /* Specific styles for horizontal menus */
        .category-card {
            flex: 0 0 auto; /* Do not grow or shrink, base on content */
            width: 120px; /* Fixed width for category cards in horizontal scroll */
        }

        .menu-item-card {
            flex: 0 0 auto; /* Do not grow or shrink, base on content */
            min-width: 250px; /* Minimum width for menu items in horizontal scroll */
            max-width: 300px; /* Max width to prevent too wide items */
        }
    </style>
</head>
<body>
    <div class="app-container">

        <!-- Modals -->
        <div id="confirmationModal" class="modal">
            <div class="modal-content">
                <span class="close-button" onclick="closeModal('confirmationModal')">&times;</span>
                <p id="modalMessage" class="text-xl font-semibold mb-4"></p>
                <button class="bg-[var(--primary-purple)] text-white px-6 py-3 rounded-full shadow-lg hover:bg-[var(--light-purple)] primary-button" onclick="closeModal('confirmationModal')">Aceptar</button>
            </div>
        </div>

        <!-- Sidebar Navigation (replacing bottom navbar) -->
        <nav class="sidebar">
            <div class="mb-8 mt-4">
                <img id="delifastLogo" src="delifast.png" alt="Delifast Logo" class="h-10">
            </div>
            <button class="flex items-center w-full py-3 px-4 rounded-xl mb-3 text-[var(--primary-purple)] bg-[var(--bg-light-purple)] active-nav" onclick="showScreen('homeScreen')">
                <i class="fas fa-home text-xl mr-3"></i>
                <span class="text-md font-medium">Inicio</span>
            </button>
            <button class="flex items-center w-full py-3 px-4 rounded-xl mb-3 text-gray-700 hover:bg-gray-100" onclick="showScreen('ordersScreen')">
                <i class="fas fa-receipt text-xl mr-3"></i>
                <span class="text-md font-medium">Pedidos</span>
            </button>
            <button class="flex items-center w-full py-3 px-4 rounded-xl mb-3 text-gray-700 hover:bg-gray-100 relative" onclick="showScreen('cartScreen')">
                <i class="fas fa-shopping-cart text-xl mr-3"></i>
                <span class="text-md font-medium">Carrito</span>
                <span id="cartItemCount" class="absolute top-1/2 -translate-y-1/2 right-4 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
            </button>
            <button class="flex items-center w-full py-3 px-4 rounded-xl mb-3 text-gray-700 hover:bg-gray-100" onclick="showScreen('profileScreen')">
                <i class="fas fa-user text-xl mr-3"></i>
                <span class="text-md font-medium">Perfil</span>
            </button>
        </nav>

        <!-- Main Content Area (where screens will be displayed) -->
        <div class="main-content">
            <!-- Home Screen -->
            <section id="homeScreen" class="screen active">
                <div class="header p-6 pb-4">
                    <div class="flex justify-between items-center mb-6">
                        <!-- Delivery Man Avatar -->
                        <div class="relative">
                            <img src="https://placehold.co/40x40/6F2DBD/FFFFFF?text=DM" alt="Delivery Man Avatar" class="w-10 h-10 rounded-full border-2 border-[var(--primary-purple)]">
                            <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></span>
                        </div>
                        <h1 class="text-3xl font-bold text-[var(--primary-purple)]">Â¡Bienvenido a Delifast!</h1>
                    </div>
                    <div class="relative">
                        <!-- Search input: Calls loadCategory('all') to show all businesses when focused -->
                        <input type="text" placeholder="Â¿QuÃ© se te antoja hoy?" class="w-full pl-10 pr-4 py-3 rounded-full bg-gray-100 text-[var(--text-dark)] focus:outline-none focus:ring-2 focus:ring-[var(--light-purple)] transition duration-200" onfocus="loadCategory('all')">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>

                <div class="flex-grow p-6 pt-0 overflow-y-auto">
                    <!-- Categories (Horizontal Scroll) -->
                    <h2 class="text-2xl font-bold text-[var(--text-dark)] my-4">CategorÃ­as</h2>
                    <div id="categoryGrid" class="flex space-x-4 overflow-x-auto pb-4 horizontal-scroll-container">
                        <!-- Category cards will be dynamically generated here -->
                    </div>

                    <!-- Featured Restaurants -->
                    <h2 class="text-2xl font-bold text-[var(--text-dark)] mb-4">Restaurantes Destacados</h2>
                    <div id="featuredRestaurantsList" class="grid grid-cols-2 gap-4">
                        <!-- Featured restaurant cards will be dynamically generated here -->
                    </div>
                </div>
            </section>

            <!-- Restaurant List Screen (for search/category results) -->
            <section id="restaurantListScreen" class="screen">
                <div class="header p-6 pb-4 flex items-center">
                    <!-- Back button for restaurant list screen: goes back to home -->
                    <button class="text-[var(--primary-purple)] mr-4 text-2xl" onclick="showScreen('homeScreen')"><i class="fas fa-arrow-left"></i></button>
                    <input type="text" placeholder="Buscar negocios..." class="flex-grow pl-10 pr-4 py-3 rounded-full bg-gray-100 text-[var(--text-dark)] focus:outline-none focus:ring-2 focus:ring-[var(--light-purple)] transition duration-200">
                    <i class="fas fa-search absolute left-20 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
                <div class="flex-grow p-6 pt-0 overflow-y-auto">
                    <!-- Title will be updated dynamically by loadCategory function -->
                    <h2 class="text-3xl font-bold text-[var(--text-dark)] mb-6"></h2>
                    <div id="allBusinessesList" class="grid grid-cols-2 gap-4">
                        <!-- All business cards will be loaded here dynamically by loadCategory -->
                    </div>
                </div>
            </section>

            <!-- Restaurant Details Screen -->
            <section id="restaurantDetailsScreen" class="screen">
                <div class="header p-6 pb-4">
                    <!-- Back button for restaurant details: goes back to the last category list -->
                    <button class="text-[var(--primary-purple)] text-2xl mb-4" onclick="loadCategory(lastCategoryFilter)"><i class="fas fa-arrow-left"></i></button>
                    <!-- Restaurant cover image will be dynamically updated by JS -->
                    <img id="restaurantCover" src="" alt="Restaurant Cover" onerror="this.onerror=null;this.src='https://placehold.co/800x300/6F2DBD/FFFFFF?text=Imagen+No+Disponible';" class="w-full h-64 object-cover rounded-xl mb-6 shadow-md">
                    <h2 id="restaurantName" class="text-4xl font-bold text-[var(--text-dark)] mb-2"></h2>
                    <p id="restaurantCuisine" class="text-gray-600 text-lg mb-2"></p>
                    <div class="flex items-center text-md text-gray-600 mb-4">
                        <i class="fas fa-star text-yellow-400 mr-1"></i> <span id="restaurantRating"></span>
                        <span class="mx-2">â¢</span> <i class="fas fa-motorcycle text-[var(--primary-purple)] mr-1"></i> <span id="restaurantDeliveryTime"></span>
                    </div>
                </div>
                <div class="flex-grow p-6 pt-0 overflow-y-auto">
                    <h3 class="text-2xl font-bold text-[var(--text-dark)] mb-4">MenÃº</h3>
                    <!-- Menu items (Horizontal Scroll on larger screens) -->
                    <div id="restaurantMenu" class="flex flex-col space-y-4 md:flex-row md:space-x-4 md:space-y-0 overflow-x-auto pb-4 horizontal-scroll-container">
                        <!-- Menu items will be loaded here dynamically -->
                    </div>
                </div>
            </section>

            <!-- Product Details Modal (simulated as a full screen for mobile flow) -->
            <section id="productDetailsScreen" class="screen">
                <div class="header p-6 pb-4">
                    <button class="text-[var(--primary-purple)] text-2xl mb-4" onclick="showScreen('restaurantDetailsScreen')"><i class="fas fa-arrow-left"></i></button>
                    <!-- Product image will be dynamically updated by JS -->
                    <img id="productImage" src="" alt="Product Image" onerror="this.onerror=null;this.src='https://placehold.co/800x400/6F2DBD/FFFFFF?text=Imagen+No+Disponible';" class="w-full h-80 object-cover rounded-xl mb-6 shadow-md">
                    <h2 id="productName" class="text-4xl font-bold text-[var(--text-dark)] mb-2"></h2>
                    <p id="productDescription" class="text-gray-600 text-lg mb-4"></p>
                    <p class="text-3xl font-bold text-[var(--primary-purple)] mb-4"><span id="productPrice"></span></p>
                </div>
                <div class="flex-grow p-6 pt-0 overflow-y-auto">
                    <div class="flex items-center justify-center space-x-4 mb-6">
                        <button class="quantity-control" onclick="updateQuantity(-1)"><i class="fas fa-minus"></i></button>
                        <span id="productQuantity" class="text-3xl font-bold text-[var(--text-dark)]">1</span>
                        <button class="quantity-control" onclick="updateQuantity(1)"><i class="fas fa-plus"></i></button>
                    </div>
                    <button class="w-full bg-[var(--primary-purple)] text-white primary-button rounded-full shadow-lg hover:bg-[var(--light-purple)] transition duration-200" onclick="addToCartFromProduct()">
                        Agregar al carrito - $<span id="totalProductPrice"></span>
                    </button>
                </div>
            </section>

            <!-- Cart Screen -->
            <section id="cartScreen" class="screen">
                <div class="header p-6 pb-4">
                    <h2 class="text-4xl font-bold text-[var(--primary-purple)] mb-6">Tu Carrito</h2>
                </div>
                <div class="flex-grow p-6 pt-0 overflow-y-auto">
                    <div id="cartItems" class="space-y-4">
                        <!-- Cart items will be loaded here -->
                        <p id="emptyCartMessage" class="text-center text-gray-500 text-xl mt-12">Tu carrito estÃ¡ vacÃ­o.</p>
                    </div>
                </div>
                <div class="p-6 bg-white border-t border-gray-100">
                    <div class="flex justify-between items-center text-xl font-semibold text-[var(--text-dark)] mb-4">
                        <span>Subtotal:</span>
                        <span id="cartSubtotal">$0.00</span>
                    </div>
                    <div class="flex justify-between items-center text-xl font-semibold text-[var(--text-dark)] mb-4">
                        <span>Costo de envÃ­o:</span>
                        <span>$3.50</span>
                    </div>
                    <div class="flex justify-between items-center text-2xl font-bold text-[var(--primary-purple)] mb-6">
                        <span>Total:</span>
                        <span id="cartTotal">$3.50</span>
                    </div>
                    <button class="w-full bg-[var(--primary-purple)] text-white primary-button rounded-full shadow-lg hover:bg-[var(--light-purple)] transition duration-200" onclick="showScreen('checkoutScreen')">
                        Proceder al Pago
                    </button>
                </div>
            </section>

            <!-- Checkout Screen -->
            <section id="checkoutScreen" class="screen">
                <div class="header p-6 pb-4 flex items-center">
                    <button class="text-[var(--primary-purple)] mr-4 text-2xl" onclick="showScreen('cartScreen')"><i class="fas fa-arrow-left"></i></button>
                    <h2 class="text-4xl font-bold text-[var(--primary-purple)]">Checkout</h2>
                </div>
                <div class="flex-grow p-6 pt-0 overflow-y-auto">
                    <h3 class="text-2xl font-bold text-[var(--text-dark)] mb-4">DirecciÃ³n de Entrega</h3>
                    <div class="bg-white p-5 rounded-xl shadow-sm mb-6">
                        <p class="font-semibold text-[var(--text-dark)] text-lg">Mi Casa</p>
                        <p class="text-gray-600 text-md">Av. Siempre Viva 742, Springfield</p>
                        <button class="text-[var(--light-purple)] mt-3 text-sm">Cambiar</button>
                    </div>

                    <h3 class="text-2xl font-bold text-[var(--text-dark)] mb-4">MÃ©todo de Pago</h3>
                    <div class="bg-white p-5 rounded-xl shadow-sm mb-6">
                        <div class="flex items-center mb-3">
                            <input type="radio" id="card" name="paymentMethod" value="card" class="form-radio text-[var(--primary-purple)] h-6 w-6" checked>
                            <label for="card" class="ml-3 text-xl text-[var(--text-dark)]">Tarjeta de CrÃ©dito/DÃ©bito</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="cash" name="paymentMethod" value="cash" class="form-radio text-[var(--primary-purple)] h-6 w-6">
                            <label for="cash" class="ml-3 text-xl text-[var(--text-dark)]">Efectivo</label>
                        </div>
                    </div>

                    <h3 class="text-2xl font-bold text-[var(--text-dark)] mb-4">Resumen del Pedido</h3>
                    <div id="checkoutSummary" class="bg-white p-5 rounded-xl shadow-sm space-y-3 mb-6">
                        <!-- Summary items will be loaded here -->
                    </div>

                    <div class="flex justify-between items-center text-2xl font-bold text-[var(--primary-purple)] mb-6">
                        <span>Total a Pagar:</span>
                        <span id="checkoutTotal">$0.00</span>
                    </div>

                    <button class="w-full bg-[var(--primary-purple)] text-white primary-button rounded-full shadow-lg hover:bg-[var(--light-purple)] transition duration-200" onclick="placeOrder()">
                        Confirmar Pedido
                    </button>
                </div>
            </section>

            <!-- Orders Screen -->
            <section id="ordersScreen" class="screen">
                <div class="header p-6 pb-4">
                    <h2 class="text-4xl font-bold text-[var(--primary-purple)] mb-6">Mis Pedidos</h2>
                </div>
                <div class="flex-grow p-6 pt-0 overflow-y-auto">
                    <div id="currentOrders" class="mb-8">
                        <h3 class="text-2xl font-bold text-[var(--text-dark)] mb-4">Pedidos Activos</h3>
                        <div class="bg-white p-5 rounded-xl shadow-sm mb-4">
                            <p class="font-semibold text-[var(--text-dark)] text-lg">Pedido #DF987654</p>
                            <p class="text-md text-gray-600">La Piazza Italiana - En camino</p>
                            <p class="text-md text-[var(--primary-purple)] font-bold">$35.00</p>
                        </div>
                        <p id="noCurrentOrders" class="text-center text-gray-500 text-xl mt-8 hidden">No tienes pedidos activos.</p>
                    </div>

                    <div id="pastOrders">
                        <h3 class="text-2xl font-bold text-[var(--text-dark)] mb-4">Historial de Pedidos</h3>
                        <div class="bg-white p-5 rounded-xl shadow-sm mb-4">
                            <p class="font-semibold text-[var(--text-dark)] text-lg">Pedido #DF123456</p>
                            <p class="text-md text-gray-600">Kyoto Sushi - Entregado</p>
                            <p class="text-md text-[var(--primary-purple)] font-bold">$28.50</p>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm mb-4">
                            <p class="font-semibold text-[var(--text-dark)] text-lg">Pedido #DF789012</p>
                            <p class="text-md text-gray-600">Green Bites - Entregado</p>
                            <p class="text-md text-[var(--primary-purple)] font-bold">$22.00</p>
                        </div>
                        <p id="noPastOrders" class="text-center text-gray-500 text-xl mt-8 hidden">No tienes pedidos anteriores.</p>
                    </div>
                </div>
            </section>

            <!-- Profile Screen -->
            <section id="profileScreen" class="screen">
                <div class="header p-6 pb-4">
                    <h2 class="text-4xl font-bold text-[var(--primary-purple)] mb-6">Mi Perfil</h2>
                </div>
                <div class="flex-grow p-6 pt-0 overflow-y-auto">
                    <div class="flex flex-col items-center mb-8">
                        <!-- User Avatar -->
                        <img src="https://placehold.co/120x120/6F2DBD/FFFFFF?text=User" alt="User Avatar" class="w-32 h-32 rounded-full border-4 border-[var(--primary-purple)] mb-4">
                        <h3 class="text-3xl font-bold text-[var(--text-dark)]">Usuario Delifast</h3>
                        <p class="text-gray-600 text-lg">usuario@example.com</p>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-5 mb-6">
                        <h4 class="font-semibold text-[var(--text-dark)] text-xl mb-4">InformaciÃ³n Personal</h4>
                        <ul class="space-y-3 text-gray-700 text-lg">
                            <li class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                                <span>Nombre:</span>
                                <span>Juan PÃ©rez</span>
                            </li>
                            <li class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                                <span>TelÃ©fono:</span>
                                <span>+51 987 654 321</span>
                            </li>
                            <li class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                                <span>DirecciÃ³n:</span>
                                <span>Av. Siempre Viva 742</span>
                            </li>
                        </ul>
                        <button class="text-[var(--light-purple)] mt-4 text-md">Editar InformaciÃ³n</button>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-5 mb-6">
                        <h4 class="font-semibold text-[var(--text-dark)] text-xl mb-4">ConfiguraciÃ³n</h4>
                        <ul class="space-y-3 text-gray-700 text-lg">
                            <li class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                                <span>Notificaciones</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" value="" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[var(--light-purple)] rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-[var(--primary-purple)]"></div>
                                </label>
                            </li>
                            <li class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                                <span>MÃ©todos de Pago</span>
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </li>
                            <li class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                                <span>Ayuda y Soporte</span>
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </li>
                        </ul>
                    </div>

                    <button class="w-full bg-red-500 text-white primary-button rounded-full shadow-lg hover:bg-red-600 transition duration-200">
                        Cerrar SesiÃ³n
                    </button>
                </div>
            </section>
        </div>
    </div>

    <script>
        // Global data stores (simulating a backend)
        const restaurantsData = {
            'restaurant1': {
                name: 'La Piazza Italiana',
                cuisine: 'Pasta, Pizza, Vino',
                type: 'Italiana',
                rating: '4.8 (500+)',
                deliveryTime: '25-35 min',
                cover: 'https://images.unsplash.com/photo-1604382354936-07c5d9983bd3?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
                menu: [
                    { id: 'item1', name: 'Pizza Margherita', description: 'La clÃ¡sica pizza con tomate, mozzarella y albahaca.', price: 12.50, image: 'https://images.unsplash.com/photo-1598023696416-0193a0bcd302?q=80&w=936&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
                    { id: 'item2', name: 'Lasagna Bolognesa', description: 'Capas de pasta, carne y bechamel, horneada a la perfecciÃ³n.', price: 14.00, image: 'https://plus.unsplash.com/premium_photo-1726783346698-aeeee98bd358?q=80&w=853&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
                    { id: 'item3', name: 'TiramisÃº', description: 'Postre italiano clÃ¡sico con cafÃ© y mascarpone.', price: 6.00, image: 'https://plus.unsplash.com/premium_photo-1695028378225-97fbe39df62a?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' }
                ]
            },
            'restaurant2': {
                name: 'Kyoto Sushi',
                cuisine: 'Sushi, Rolls, Sashimi',
                type: 'Japonesa',
                rating: '4.9 (700+)',
                deliveryTime: '30-40 min',
                cover: 'https://plus.unsplash.com/premium_photo-1668146927669-f2edf6e86f6f?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
                menu: [
                    { id: 'item4', name: 'Combo Nigiri (12 pzs)', description: 'SelecciÃ³n variada de nigiri fresco.', price: 20.00, image: 'https://images.unsplash.com/photo-1637074930269-089fde202b57?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
                    { id: 'item5', name: 'Roll California (8 pzs)', description: 'Aguacate, cangrejo y pepino.', price: 10.50, image: 'https://images.unsplash.com/photo-1563282397-cdc218eccfda?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
                    { id: 'item6', name: 'Sashimi de SalmÃ³n (6 pzs)', description: 'Finas lÃ¡minas de salmÃ³n fresco.', price: 18.00, image: 'https://images.unsplash.com/photo-1638866381709-071747b518c8?q=80&w=812&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' }
                ]
            },
            'restaurant3': {
                name: 'Green Bites',
                cuisine: 'Ensaladas, Bowls, Jugos',
                type: 'Saludable',
                rating: '4.7 (300+)',
                deliveryTime: '20-30 min',
                cover: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
                menu: [
                    { id: 'item7', name: 'Bowl de Quinoa', description: 'Quinoa, vegetales asados, aguacate y aderezo de limÃ³n.', price: 11.00, image: 'https://images.unsplash.com/photo-1615865417491-9941019fbc00?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
                    { id: 'item8', name: 'Ensalada CÃ©sar con Pollo', description: 'Lechuga romana, crutones, parmesano y pollo a la parrilla.', price: 10.00, image: 'https://images.unsplash.com/photo-1607532941433-304659e8198a?q=80&w=778&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
                    { id: 'item9', name: 'Jugo Verde Detox', description: 'Manzana, espinaca, apio y jengibre.', price: 5.50, image: 'https://plus.unsplash.com/premium_photo-1675011400509-5e39c4c17309?q=80&w=406&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' }
                ]
            },
            'restaurant4': {
                name: 'Taco Loco Mexicano',
                cuisine: 'Tacos, Burritos, Quesadillas',
                type: 'Mexicana',
                rating: '4.5 (250+)',
                deliveryTime: '30-45 min',
                cover: 'https://plus.unsplash.com/premium_photo-1681406995059-972cf4e86568?q=80&w=387&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
                menu: [
                    { id: 'item10', name: 'Tacos al Pastor (3)', description: 'Con cerdo marinado, piÃ±a y cilantro.', price: 9.00, image: 'https://plus.unsplash.com/premium_photo-1681406994990-e16f7e02e027?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
                    { id: 'item11', name: 'Burrito Suizo', description: 'Carne, arroz, frijoles y queso gratinado.', price: 11.50, image: 'https://images.unsplash.com/photo-1662116765994-1e4200c43589?q=80&w=1332&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
                    { id: 'item12', name: 'Nachos Supreme', description: 'Totopos, queso, jalapeÃ±os, frijoles y crema.', price: 8.50, image: 'https://images.unsplash.com/photo-1464219222984-216ebffaaf85?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' }
                ]
            },
            'restaurant5': {
                name: 'Burger Joint',
                cuisine: 'Hamburguesas, Papas Fritas, Malteadas',
                type: 'Americana',
                rating: '4.6 (600+)',
                deliveryTime: '20-30 min',
                cover: 'https://images.unsplash.com/photo-1572802419224-296b0aeee0d9?q=80&w=815&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
                menu: [
                    { id: 'item13', name: 'Classic Cheeseburger', description: 'Carne, queso cheddar, lechuga, tomate y pepinillos.', price: 13.00, image: 'https://images.unsplash.com/photo-1547584370-2cc98b8b8dc8?q=80&w=871&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
                    { id: 'item14', name: 'Papas Fritas Grandes', description: 'Papas crujientes y saladas.', price: 4.00, image: 'https://images.unsplash.com/photo-1518013431117-eb1465fa5752?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
                    { id: 'item15', name: 'Malteada de Chocolate', description: 'ClÃ¡sica malteada con helado de chocolate.', price: 6.50, image: 'https://plus.unsplash.com/premium_photo-1667544654787-cd984212004d?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' }
                ]
            },
            'restaurant6': {
                name: 'The Coffee Spot',
                cuisine: 'CafÃ©, PastelerÃ­a, Desayunos',
                type: 'CafeterÃ­a',
                rating: '4.7 (400+)',
                deliveryTime: '15-25 min',
                cover: 'https://plus.unsplash.com/premium_photo-1675435644687-562e8042b9db?q=80&w=449&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
                menu: [
                    { id: 'item16', name: 'Latte Caliente', description: 'CafÃ© espresso con leche espumada.', price: 4.00, image: 'https://images.unsplash.com/photo-1541167760496-1628856ab772?q=80&w=1337&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
                    { id: 'item17', name: 'Croissant de Almendras', description: 'Croissant reciÃ©n horneado con relleno de almendras.', price: 3.50, image: 'https://images.unsplash.com/photo-1649542181703-33cc4f373b28?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
                    { id: 'item18', name: 'Bowl de Avena con Frutas', description: 'Avena caliente con frutas frescas y miel.', price: 7.00, image: 'https://images.unsplash.com/photo-1498507297833-5373e346b4e0?q=80&w=725&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' }
                ]
            },
            // New categories with example businesses
            'supermarket1': {
                name: 'MegaMart',
                cuisine: 'Abarrotes, Frescos, Hogar',
                type: 'Supermercado',
                rating: '4.6 (1200+)',
                deliveryTime: '45-60 min',
                cover: 'https://plus.unsplash.com/premium_photo-1661407806034-4eaf2671322f?q=80&w=902&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
                menu: []
            },
            'supermarket2': {
                name: 'Frescura Express',
                cuisine: 'Frutas, Verduras OrgÃ¡nicas',
                type: 'Supermercado',
                rating: '4.9 (850+)',
                deliveryTime: '30-40 min',
                cover: 'https://images.unsplash.com/photo-1609780447631-05b93e5a88ea?q=80&w=774&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
                menu: []
            },
            'pharmacy1': {
                name: 'Farmacia Salud',
                cuisine: 'Medicamentos, Cuidado Personal',
                type: 'Farmacia',
                rating: '4.8 (800+)',
                deliveryTime: '20-30 min',
                cover: 'https://plus.unsplash.com/premium_photo-1661766456250-bbde7dd079de?q=80&w=872&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
                menu: []
            },
            'pharmacy2': {
                name: 'Botica Bienestar',
                cuisine: 'Vitaminas, Suplementos',
                type: 'Farmacia',
                rating: '4.7 (500+)',
                deliveryTime: '25-35 min',
                cover: 'https://images.unsplash.com/photo-1631549916768-4119b2e5f926?q=80&w=879&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
                menu: []
            },
            'store1': {
                name: 'TechGadget',
                cuisine: 'ElectrÃ³nica, Accesorios, Hogar Inteligente',
                type: 'Tienda',
                rating: '4.5 (300+)',
                deliveryTime: '30-40 min',
                cover: 'https://images.unsplash.com/photo-1563770660941-20978e870e26?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
                menu: []
            },
            'store2': {
                name: 'LibrerÃ­a El Saber',
                cuisine: 'Libros, PapelerÃ­a, Revistas',
                type: 'Tienda',
                rating: '4.7 (150+)',
                deliveryTime: '35-50 min',
                cover: 'https://images.unsplash.com/photo-1525358180237-7399f908a1d9?q=80&w=878&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
                menu: []
            }
        };

        const categories = [
            { name: 'Restaurantes', icon: 'fas fa-utensils', type: 'Comida' },
            { name: 'Supermercados', icon: 'fas fa-shopping-basket', type: 'Supermercado' },
            { name: 'Farmacias', icon: 'fas fa-pills', type: 'Farmacia' },
            { name: 'CafeterÃ­as', icon: 'fas fa-coffee', type: 'CafeterÃ­a' },
            { name: 'Tiendas', icon: 'fas fa-box', type: 'Tienda' },
            { name: 'MÃ¡s', icon: 'fas fa-ellipsis-h', type: 'all' } // 'all' for general list
        ];

        let currentCart = [];
        let currentProduct = null;
        let currentProductQuantity = 1;
        let lastCategoryFilter = 'all';

        // Function to show a specific screen and hide others
        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');

            // Update active state in sidebar nav
            const navButtons = document.querySelectorAll('.sidebar button');
            navButtons.forEach(button => button.classList.remove('text-[var(--primary-purple)]', 'bg-[var(--bg-light-purple)]', 'active-nav'));
            navButtons.forEach(button => {
                const iconClass = button.querySelector('i').classList[1];
                if ((screenId === 'homeScreen' && iconClass === 'fa-home') ||
                    (screenId === 'ordersScreen' && iconClass === 'fa-receipt') ||
                    (screenId === 'cartScreen' && iconClass === 'fa-shopping-cart') ||
                    (screenId === 'profileScreen' && iconClass === 'fa-user')) {
                    button.classList.add('text-[var(--primary-purple)]', 'bg-[var(--bg-light-purple)]', 'active-nav');
                } else {
                    button.classList.add('text-gray-700', 'hover:bg-gray-100');
                }
            });

            if (screenId === 'cartScreen') {
                renderCart();
            } else if (screenId === 'checkoutScreen') {
                renderCheckoutSummary();
            }
        }

        /**
         * Renders the list of businesses (restaurants, supermarkets, etc.) in the provided container.
         * @param {HTMLElement} container - The DOM element to render businesses into.
         * @param {Array} businessesToRender - Array of business objects to display.
         */
        function renderBusinesses(container, businessesToRender) {
            container.innerHTML = ''; // Clear previous content

            if (businessesToRender.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 text-lg mt-8">No hay resultados disponibles en este momento.</p>';
                return;
            }

            businessesToRender.forEach(business => {
                const businessId = Object.keys(restaurantsData).find(key => restaurantsData[key] === business);
                const businessCardHtml = `
                    <div class="bg-white rounded-xl shadow-md overflow-hidden cursor-pointer hover:shadow-lg transition" onclick="showRestaurantDetails('${businessId}')">
                        <img src="${business.cover}" alt="${business.name}" onerror="this.onerror=null;this.src='https://placehold.co/400x180/6F2DBD/FFFFFF?text=Imagen+No+Disponible';" class="w-full h-40 object-cover">
                        <div class="p-4">
                            <h3 class="font-bold text-lg text-[var(--text-dark)]">${business.name}</h3>
                            <p class="text-sm text-gray-500">${business.cuisine}</p>
                            <div class="flex items-center text-sm text-gray-600 mt-2">
                                <i class="fas fa-star text-yellow-400 mr-1"></i> ${business.rating}
                                <span class="mx-2">â¢</span> <i class="fas fa-motorcycle text-[var(--primary-purple)] mr-1"></i> ${business.deliveryTime}
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += businessCardHtml;
            });
        }

        /**
         * Loads and displays a list of businesses based on the specified category filter.
         * Updates the screen title and populates the business list.
         * @param {string} filterType - The category type to filter by ('all', 'Comida', 'CafeterÃ­a', 'Supermercado', 'Farmacia', 'Tienda').
         */
        function loadCategory(filterType) {
            lastCategoryFilter = filterType;

            let filteredBusinesses = Object.values(restaurantsData);
            let screenTitle = "Todos los Negocios";
            let noResultsMessage = "No hay resultados para esta categorÃ­a.";

            switch (filterType) {
                case 'Comida':
                    filteredBusinesses = filteredBusinesses.filter(b => ['Italiana', 'Japonesa', 'Mexicana', 'Americana', 'Saludable'].includes(b.type));
                    screenTitle = "Restaurantes de Comida";
                    noResultsMessage = "No hay restaurantes de comida disponibles en este momento.";
                    break;
                case 'CafeterÃ­a':
                    filteredBusinesses = filteredBusinesses.filter(b => b.type === 'CafeterÃ­a');
                    screenTitle = "CafeterÃ­as";
                    noResultsMessage = "No hay cafeterÃ­as disponibles en este momento.";
                    break;
                case 'Supermercado':
                    filteredBusinesses = filteredBusinesses.filter(b => b.type === 'Supermercado');
                    screenTitle = "Supermercados";
                    noResultsMessage = "Â¡Pronto! No hay supermercados disponibles en este momento.";
                    break;
                case 'Farmacia':
                    filteredBusinesses = filteredBusinesses.filter(b => b.type === 'Farmacia');
                    screenTitle = "Farmacias";
                    noResultsMessage = "Â¡Pronto! No hay farmacias disponibles en este momento.";
                    break;
                case 'Tienda':
                    filteredBusinesses = filteredBusinesses.filter(b => b.type === 'Tienda');
                    screenTitle = "Tiendas Varias";
                    noResultsMessage = "Â¡Pronto! No hay tiendas disponibles en este momento.";
                    break;
                case 'all': // Default for 'MÃ¡s' category or search bar focus
                default:
                    filteredBusinesses = filteredBusinesses.filter(b => b.type); // Show all known types
                    screenTitle = "Todos los Negocios";
                    noResultsMessage = "No hay negocios disponibles en este momento.";
                    break;
            }

            const allBusinessesListContainer = document.getElementById('allBusinessesList');
            document.getElementById('restaurantListScreen').querySelector('h2').innerText = screenTitle;
            renderBusinesses(allBusinessesListContainer, filteredBusinesses); // Use the new render function
            showScreen('restaurantListScreen');
        }

        // Function to populate restaurant details and show its screen
        function showRestaurantDetails(restaurantId) {
            const restaurant = restaurantsData[restaurantId];
            if (!restaurant) {
                console.error('Restaurant not found:', restaurantId);
                return;
            }

            document.getElementById('restaurantCover').src = restaurant.cover;
            document.getElementById('restaurantName').innerText = restaurant.name;
            document.getElementById('restaurantCuisine').innerText = restaurant.cuisine;
            document.getElementById('restaurantRating').innerText = restaurant.rating;
            document.getElementById('restaurantDeliveryTime').innerText = restaurant.deliveryTime;

            const menuContainer = document.getElementById('restaurantMenu');
            menuContainer.innerHTML = '';

            if (restaurant.menu && restaurant.menu.length > 0) {
                restaurant.menu.forEach(item => {
                    const menuItemHtml = `
                        <div class="menu-item-card bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition cursor-pointer flex flex-col items-start" onclick="showProductDetails('${restaurantId}', '${item.id}')">
                            <img src="${item.image}" alt="${item.name}" onerror="this.onerror=null;this.src='https://placehold.co/150x100/6F2DBD/FFFFFF?text=Imagen+No+Disponible';" class="w-full h-32 object-cover rounded-md mb-4">
                            <h4 class="font-semibold text-lg text-[var(--text-dark)]">${item.name}</h4>
                            <p class="text-sm text-gray-500 line-clamp-2 mb-2">${item.description}</p>
                            <p class="font-bold text-[var(--primary-purple)] mt-auto text-lg">$${item.price.toFixed(2)}</p>
                            <button class="bg-[var(--accent-green)] text-white p-2 rounded-full text-base self-end"><i class="fas fa-plus"></i></button>
                        </div>
                    `;
                    menuContainer.innerHTML += menuItemHtml;
                });
            } else {
                menuContainer.innerHTML = '<p class="text-center text-gray-500 text-lg mt-8">Este negocio no tiene un menÃº para mostrar.</p>';
            }

            showScreen('restaurantDetailsScreen');
        }

        // Function to show product details and allow adding to cart
        function showProductDetails(restaurantId, productId) {
            const restaurant = restaurantsData[restaurantId];
            if (!restaurant) {
                console.error('Restaurant not found:', restaurantId);
                return;
            }
            const product = restaurant.menu.find(item => item.id === productId);
            if (!product) {
                console.error('Product not found:', productId);
                return;
            }

            currentProduct = { ...product, restaurantName: restaurant.name };
            currentProductQuantity = 1;

            document.getElementById('productImage').src = product.image;
            document.getElementById('productName').innerText = product.name;
            document.getElementById('productDescription').innerText = product.description;
            document.getElementById('productPrice').innerText = product.price.toFixed(2);
            document.getElementById('productQuantity').innerText = currentProductQuantity;
            document.getElementById('totalProductPrice').innerText = (product.price * currentProductQuantity).toFixed(2);

            showScreen('productDetailsScreen');
        }

        // Update quantity in product details screen
        function updateQuantity(change) {
            currentProductQuantity += change;
            if (currentProductQuantity < 1) {
                currentProductQuantity = 1;
            }
            document.getElementById('productQuantity').innerText = currentProductQuantity;
            document.getElementById('totalProductPrice').innerText = (currentProduct.price * currentProductQuantity).toFixed(2);
        }

        // Add the currently viewed product to cart
        function addToCartFromProduct() {
            if (currentProduct) {
                const existingItem = currentCart.find(item => item.id === currentProduct.id);
                if (existingItem) {
                    existingItem.quantity += currentProductQuantity;
                } else {
                    currentCart.push({ ...currentProduct, quantity: currentProductQuantity });
                }
                updateCartCount();
                showModal(`"${currentProduct.name}" (${currentProductQuantity} unidad${currentProductQuantity > 1 ? 'es' : ''}) agregado al carrito.`);
                showScreen('restaurantDetailsScreen');
            }
        }

        // Render items in the cart screen
        function renderCart() {
            const cartItemsContainer = document.getElementById('cartItems');
            cartItemsContainer.innerHTML = '';
            let subtotal = 0;

            if (currentCart.length === 0) {
                document.getElementById('emptyCartMessage').classList.remove('hidden');
            } else {
                document.getElementById('emptyCartMessage').classList.add('hidden');
                currentCart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    subtotal += itemTotal;
                    const cartItemHtml = `
                        <div class="flex items-center bg-white p-4 rounded-xl shadow-sm">
                            <img src="${item.image}" alt="${item.name}" onerror="this.onerror=null;this.src='https://placehold.co/150x100/6F2DBD/FFFFFF?text=Imagen+No+Disponible';" class="w-20 h-20 object-cover rounded-md mr-4">
                            <div class="flex-grow">
                                <h4 class="font-semibold text-lg text-[var(--text-dark)]">${item.name}</h4>
                                <p class="text-md text-gray-500">${item.restaurantName}</p>
                                <p class="font-bold text-[var(--primary-purple)] mt-1 text-lg">$${item.price.toFixed(2)}</p>
                            </div>
                            <div class="flex items-center space-x-2 quantity-control">
                                <button onclick="updateCartItemQuantity('${item.id}', -1)" class="bg-gray-200 text-gray-700 px-3 py-1 rounded-full text-md"><i class="fas fa-minus"></i></button>
                                <span class="font-bold text-[var(--text-dark)] text-xl">${item.quantity}</span>
                                <button onclick="updateCartItemQuantity('${item.id}', 1)" class="bg-gray-200 text-gray-700 px-3 py-1 rounded-full text-md"><i class="fas fa-plus"></i></button>
                                <button onclick="removeCartItem('${item.id}')" class="text-red-500 ml-3 text-2xl"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </div>
                    `;
                    cartItemsContainer.innerHTML += cartItemHtml;
                });
            }

            const deliveryCost = 3.50;
            const total = subtotal + deliveryCost;

            document.getElementById('cartSubtotal').innerText = `$${subtotal.toFixed(2)}`;
            document.getElementById('cartTotal').innerText = `$${total.toFixed(2)}`;
        }

        // Update quantity of an item directly in the cart
        function updateCartItemQuantity(productId, change) {
            const itemIndex = currentCart.findIndex(item => item.id === productId);
            if (itemIndex > -1) {
                currentCart[itemIndex].quantity += change;
                if (currentCart[itemIndex].quantity <= 0) {
                    currentCart.splice(itemIndex, 1);
                }
                renderCart();
                updateCartCount();
            }
        }

        // Remove an item from the cart
        function removeCartItem(productId) {
            currentCart = currentCart.filter(item => item.id !== productId);
            renderCart();
            updateCartCount();
        }

        // Update the cart item count displayed in the navbar
        function updateCartCount() {
            const itemCount = currentCart.reduce((sum, item) => sum + item.quantity, 0);
            const cartItemCountSpan = document.getElementById('cartItemCount');
            if (itemCount > 0) {
                cartItemCountSpan.innerText = itemCount;
                cartItemCountSpan.classList.remove('hidden');
            } else {
                cartItemCountSpan.classList.add('hidden');
            }
        }

        // Render checkout summary
        function renderCheckoutSummary() {
            const checkoutSummaryContainer = document.getElementById('checkoutSummary');
            checkoutSummaryContainer.innerHTML = '';
            let subtotal = 0;

            if (currentCart.length === 0) {
                checkoutSummaryContainer.innerHTML = '<p class="text-center text-gray-500">Tu carrito estÃ¡ vacÃ­o.</p>';
                document.getElementById('checkoutTotal').innerText = '$0.00';
                return;
            }

            currentCart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                const summaryItemHtml = `
                    <div class="flex justify-between items-center text-md text-gray-700">
                        <span>${item.name} x ${item.quantity}</span>
                        <span>$${itemTotal.toFixed(2)}</span>
                    </div>
                `;
                checkoutSummaryContainer.innerHTML += summaryItemHtml;
            });

            const deliveryCost = 3.50;
            const total = subtotal + deliveryCost;

            const subtotalLine = `
                <div class="flex justify-between items-center text-lg font-semibold text-[var(--text-dark)] mt-3 border-t border-gray-100 pt-3">
                    <span>Subtotal:</span>
                    <span>$${subtotal.toFixed(2)}</span>
                </div>
            `;
            const deliveryLine = `
                <div class="flex justify-between items-center text-lg font-semibold text-[var(--text-dark)]">
                    <span>EnvÃ­o:</span>
                    <span>$${deliveryCost.toFixed(2)}</span>
                </div>
            `;
            checkoutSummaryContainer.innerHTML += subtotalLine + deliveryLine;
            document.getElementById('checkoutTotal').innerText = `$${total.toFixed(2)}`;
        }

        // Simulate placing an order
        function placeOrder() {
            if (currentCart.length === 0) {
                showModal("No puedes realizar un pedido con el carrito vacÃ­o.");
                return;
            }
            showModal("Â¡Tu pedido ha sido realizado con Ã©xito!");
            currentCart = [];
            updateCartCount();
            setTimeout(() => showScreen('ordersScreen'), 1500);
        }

        // --- Modal functions ---
        function showModal(message) {
            document.getElementById('modalMessage').innerText = message;
            document.getElementById('confirmationModal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // --- Initial Render Functions ---

        /**
         * Renders the category cards on the home screen dynamically.
         */
        function renderCategories() {
            const categoryGrid = document.getElementById('categoryGrid');
            categoryGrid.innerHTML = ''; // Clear existing content

            categories.forEach(category => {
                const categoryCardHtml = `
                    <div class="category-card flex flex-col items-center p-4 bg-white rounded-xl shadow-sm hover:shadow-md transition cursor-pointer" data-category-type="${category.type}">
                        <div class="w-16 h-16 bg-[var(--bg-light-purple)] rounded-full flex items-center justify-center mb-2">
                            <i class="${category.icon} text-2xl text-[var(--primary-purple)]"></i>
                        </div>
                        <span class="text-md font-medium text-[var(--gray-text)]">${category.name}</span>
                    </div>
                `;
                categoryGrid.innerHTML += categoryCardHtml;
            });

            // Add event listener to the parent grid for delegation
            categoryGrid.addEventListener('click', (event) => {
                const clickedCard = event.target.closest('.category-card');
                if (clickedCard) {
                    const categoryType = clickedCard.dataset.categoryType;
                    loadCategory(categoryType);
                }
            });
        }

        /**
         * Renders a selection of featured restaurants on the home screen.
         */
        function renderFeaturedRestaurants() {
            const featuredListContainer = document.getElementById('featuredRestaurantsList');
            featuredListContainer.innerHTML = '';

            const allRestaurants = Object.values(restaurantsData).filter(b => b.type && ['Italiana', 'Japonesa', 'Mexicana', 'Americana', 'Saludable'].includes(b.type));
            // Shuffle and pick top 3 for featured
            const shuffledRestaurants = allRestaurants.sort(() => 0.5 - Math.random());
            const featured = shuffledRestaurants.slice(0, 3);

            renderBusinesses(featuredListContainer, featured);
        }

        // Initial setup on load
        document.addEventListener('DOMContentLoaded', () => {
            renderCategories(); // Render categories dynamically
            renderFeaturedRestaurants(); // Render featured restaurants
            showScreen('homeScreen'); // Ensure home screen is active on load
            updateCartCount(); // Initialize cart count

            showModal("Â¡Bienvenido a Delifast! ð");
        });

    </script>
</body>
</html>
